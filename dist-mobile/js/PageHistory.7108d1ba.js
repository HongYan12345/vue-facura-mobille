import{E as T,a2 as $,J as A,a3 as J,S as I,r as V,t as R,a as N,I as j,u as H,c as P,e as D,o as q,O as z,a4 as M,T as U,q as o,U as G,a5 as K,L as Q,h as W,j as l,k as F,l as E,p as i,w as d,s as b,v as w}from"./index.f87cd9a6.js";const X=T({components:{CopyOutlined:$,DeleteOutlined:A,LoadingOutlined:J,SearchOutlined:I},setup(){const t=V({isLoading:!0}),p=R(t),u=N(""),{t:L}=j(),f=H(),r=P(),n=N([]),m=D(()=>u.value?n.value.filter(e=>e.factura_date.includes(u.value)||e.factura_num.toString().includes(u.value)||JSON.parse(e.user).name.includes(u.value)):n.value),_=()=>{n.value=[],r.state.isVisitor?M().then(e=>{console.log("[PageHistory]factura en base de dato:",e),e.forEach(a=>{n.value.push(a)}),t.isLoading=!1}):z("facturas").then(e=>{console.log("[PageHistory]factura en FireBase:",e),e.forEach(a=>{n.value.push(a)}),t.isLoading=!1}).catch(e=>{console.error("Error getting data: ",e)})},C=D(()=>[...m.value].sort((a,s)=>{const h=new Date(a.factura_date.split("/").reverse().join("-")).getTime(),O=new Date(s.factura_date.split("/").reverse().join("-")).getTime();return h==O?Number(s.factura_num)-Number(a.factura_num):O-h})),k=()=>{S(),f.back()},S=()=>{r.commit("RESET_STATE")},v=e=>{const a=JSON.parse(e.empresa),s=JSON.parse(e.euro_final),h=JSON.parse(e.item_list),O=JSON.parse(e.user);console.log(s),r.commit("saveCliente",O),r.commit("saveData",{dataArray:h,euroBase:s.total,dto:s.dto,isRe:s.re!=0,isIva:s.iva!=0}),r.commit("saveFinal",s),r.commit("saveEmpresa",a),r.commit("saveNum",{num:e.factura_num,date:e.factura_date,forma:e.forma})},y=e=>{v(e),f.push({name:"pdf",params:{history:1}})},c=e=>{v(e),f.push({name:"company"})},g=e=>{U.confirm({title:()=>"Do you want to delete these items?",icon:()=>o(G),content:()=>"",onOk(){K(e.id).then(a=>{console.log("delect success",a),r.state.isVisitor||Q("facturas",e.factura_num+e.factura_date.split("/")[2]).then(s=>{console.log("delect success",s),_()}).catch(s=>{console.error("Error getting data: ",s)})}).catch(a=>{console.error("Error getting data: ",a)})},onCancel(){}})},B=e=>{const a=JSON.parse(e.user);return"Nº: "+e.factura_num+", "+e.factura_date+", "+a.name};return q(()=>{_()}),{...p,t:L,factura_list:n,goBack:k,parsedItem:B,goFactura:y,newFactura:c,sortedFacturaList:C,deletFactura:g,filteredClients:m,searchString:u}}}),Y={class:"button-container"},Z={key:0},x={key:1},ee={class:"item-row"},te=["onClick"];function ae(t,p,u,L,f,r){const n=l("a-button"),m=l("LoadingOutlined"),_=l("SearchOutlined"),C=l("a-input"),k=l("CopyOutlined"),S=l("DeleteOutlined"),v=l("a-list-item"),y=l("a-list");return F(),E("div",null,[i("div",Y,[o(n,{onClick:t.goBack,class:"btn-back",size:"large"},{default:d(()=>[b(w(t.$t("back")),1)]),_:1},8,["onClick"])]),t.isLoading?(F(),E("div",Z,[i("div",null,[o(m)])])):(F(),E("div",x,[i("div",null,[o(C,{class:"search-input",placeholder:"Search",value:t.searchString,"onUpdate:value":p[0]||(p[0]=c=>t.searchString=c)},{suffix:d(()=>[o(_)]),_:1},8,["value"])]),o(y,{class:"a-list","item-layout":"horizontal","data-source":t.sortedFacturaList,locale:{emptyText:" "}},{renderItem:d(({item:c})=>[o(v,null,{default:d(()=>[i("div",ee,[i("a",{class:"item-details",onClick:g=>t.goFactura(c)},[i("div",null,[i("div",null,w(t.parsedItem(c)),1)])],8,te),o(n,{onClick:g=>t.newFactura(c)},{default:d(()=>[o(k)]),_:2},1032,["onClick"]),b("   "),o(n,{onClick:g=>t.deletFactura(c)},{default:d(()=>[o(S)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["data-source"])]))])}const oe=W(X,[["render",ae]]);export{oe as default};
